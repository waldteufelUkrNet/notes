ДОВГІ ЗАПИТИ КЛІЄНТ - СЕРВЕР
================================================================================

Що це і для чого
----------------

Це спосіб організації постійного зв'язку клієнт - сервер, наприклад для
месенджерів, але таких, де повідомлення приходять рідко.


Схема
-----

1. Запит відправляється на сервер
2. Сервер не закриває з'єднання. Воно "висить", поки на сервері не з'явиться
   повідомлення для клієнта. Як тільки з'являється повідомлення, сервер надсилає
   відповідь і закриває з'єднання.
3. Клієнт отримує відповідь, обробляє її і робить новий запит на сервер.


Сервер повинен вміти працювати з такою технологією!


Приклад клієнтського коду
-------------------------

    async function subscribe() {
      let response = await fetch("/subscribe");

      if (response.status == 502) {         // Статус 502 - це таймаут з'єднан-
        await subscribe();                  // ня (якщо з'єднання очікувало за-
                                            // надто довго і сервер його закрив)
      } else if (response.status != 200) {  // Обробка помилки, повторне
        showMessage(response.statusText);   // з'єднання через 1с
        await new Promise(resolve => setTimeout(resolve, 1000));
        await subscribe();
      } else {                              // успішна відповідь сервера
        let message = await response.text();
        showMessage(message);
        await subscribe();                  // повторний запит
      }
    }

    subscribe();