GraphQL
================================================================================

**GraphQL** - це мова запитів клієнт/сервер та середовище для виконня таких запитів. Підтримує багато мов програмування, в тому числі JS. Є "прокладкою" між запитом і базою даних. Бази даних можуть використовуватися будь-які. Виконує аналогічні
функції, що і REST API.

**Відмінність від REST API**

1. В **REST API** кожен запит має свою адресу, а в **GraphQL** адреса для
   запитів одна, закінчується, як правило, на `\graphql`.
2. Якщо потрібно отримати з'вязані дані, в **REST API** імовірно доведеться
   робити кілька запитів, а в **GraphQL** можна налаштувати один запит, причому
   також можна одразу запитувати залежні сутності з різних таблиць.
3. Схемою даних управляє клієнт, а не сервер: клієнт формує запит тільки для
   потрібних полів і отримує відповідь у потрібному форматі. Завдяки цьому
   вдається знизити навантаження на сервер. В **REST API** для зменшення
   навантаження доводиться використовувати мікросерверну архітектуру:
   однин url - одні дані.



Принцип роботи
--------------------------------------------------------------------------------

Відображення сутності на поля в запиті прописуються на стороні бекенда за допомогою спеціальних бібліотек. **GraphQL** - це по суті мапінг (відображення) полів з бази даних на свою схему. Схеми **GraphQL** типізовані.

### Типи запитів
1. **query** - тільки читання, аналог get-запиту. Виконуються паралельно.
2. **mutation** - запит на зміну даних, додавання, видалення. Аналог post, put,
   delete запитів. Виконуються послідовно.

**приклад запиту (на GraphiQL):**
```
query {
  continents {
    name
    code
    countries {
      name
      code
    }
  }
}
```

результатом буде:
```
{
  "data": {
    "continents": [
      {
        "name": "Africa",
        "code": "AF",
        "countries": [
          {
            "name": "Angola",
            "code": "AO"
          },
          …
        ]
      },
      …
    ]
  }
}
```

У запитах можна використовувати змінні. В середині запиту вони повинні починатися з $. Їх потрібно задекларувати і вказати значення у блоці оголошення змінних **QUERY VARIABLES**:

```
query (
  $code: String!  ## ! - позначення обов'язкового поля
) {
  continents (
    filter: {     ## ключове слово, вказане в реалізації бекенду GraphiQL
      code: {
        eq: $code
      }
    }
  ) {
    name
    code
  }
}
```

блок оголошення змінних:
```
{
  "code": "EU"
}
```

результатом будуть наступні дані:
```
{
  "data": {
    "continents": [
      {
        "name": "Europe",
        "code": "EU"
      }
    ]
  }
}
```

Якщо в запитах є однотипні рядки, то для скорочення коду можна використовувати
фрагменти **fragments**:
```
fragment someFields on Continent {
  code
  name
}

query (
  $code: String = "EU" ## значення за замовчуванням
) {
  continents (
    filter: {
      code: {
        eq: $code
      }
    }
  ) {
    ...someFields
  }
}
```

Якщо запит складний, потрібно слідкувати, щоб дані, які вертаються (вони є об'єктом), не мали однакових полів. Для цього використовуються **aliases**.
Приклад коду:

```
fragment someFields on Continent {
  code
  name
}

query (
  $code: String = "EU" ## значення за замовчуванням
) {
  eu: continents (     ## <-
    filter: {
      code: {
        eq: $code
      }
    }
  ) {
    ...someFields
  }
  as: continents (     ## <-
    filter: {
      code: {
        eq: $code
      }
    }
  ) {
    ...someFields
  }
}
```

результат:
```
{
  "data": {
    "eu": [
      {
        "code": "EU",
        "name": "Europe"
      }
    ],
    "as": [
      {
        "code": "EU",
        "name": "Europe"
      }
    ]
  }
}
```

для розуміння, в якому запиті відбулася помилка, доброю практикою є вказування
імені для запитів

```
query query_name (…) {…}
```

директива **@include**:
```
query continents_query(
  $includeCountries: Boolean = false
) {
  continents {
    code
    name
  }
  countries @include(if: $includeCountries) {
    code
    name
  }
}
```

директива **@skip** - антипод **@include**:
```
query continents_query(
  $skipCountries: Boolean = false
) {
  continents {
    code
    name
  }
  countries @skip(if: $skipCountries) {
    code
    name
  }
}
```

inline fragments:
```

```




Для отримання даних з бд спочатку пишуться типи, на основі яких потім пишуться функції, які вертають набір полів у якості об'єктів/масивів об'єктів/рядків. Доступ до зв'язаних структур відбувається саме в них.




Посилання
--------------------------------------------------------------------------------

1. [Офіційний сайт](https://graphql.org/)
2. [GraphiQL is an in-browser tool for writing, validating, and testing GraphQL
   queries](https://lucasconstantino.github.io/graphiql-online/)
3. [Youtube: Все о GraphQL за 30 минут](https://www.youtube.com/watch?v=7zEaHr_iJjA)
4. [Youtube: 17 відео] (https://www.youtube.com/watch?v=kZs7CXrtT-s&list=PLNkWIWHIRwMF2sVLwzRef0Cu5kzAOeRcu)